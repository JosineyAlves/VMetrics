<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Completo de Integra√ß√£o Stripe para SAAS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #635bff 0%, #4f46e5 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 12px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .nav {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav h3 {
            margin-bottom: 15px;
            color: #635bff;
        }

        .nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .nav a {
            color: #4f46e5;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
            display: block;
        }

        .nav a:hover {
            background-color: #f3f4f6;
        }

        .section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h2 {
            color: #635bff;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #635bff;
            padding-bottom: 10px;
        }

        h3 {
            color: #4f46e5;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #6366f1;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #635bff;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #635bff;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #fdcb6e;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #17a2b8;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .nav ul {
                grid-template-columns: 1fr;
            }
            
            .section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Guia Completo de Integra√ß√£o Stripe para SAAS</h1>
            <p class="subtitle">Tudo que voc√™ precisa saber para integrar pagamentos, assinaturas e gerenciamento de usu√°rios</p>
        </header>

        <nav class="nav">
            <h3>√çndice de Conte√∫do</h3>
            <ul>
                <li><a href="#introducao">Introdu√ß√£o</a></li>
                <li><a href="#visao-geral">Vis√£o Geral da Integra√ß√£o</a></li>
                <li><a href="#apis-sdks">APIs e SDKs</a></li>
                <li><a href="#autenticacao">Autentica√ß√£o</a></li>
                <li><a href="#produtos-precos">Produtos e Pre√ßos</a></li>
                <li><a href="#assinaturas">Gerenciamento de Assinaturas</a></li>
                <li><a href="#webhooks">Webhooks e Notifica√ß√µes</a></li>
                <li><a href="#customer-portal">Portal do Cliente</a></li>
                <li><a href="#cancelamentos">Cancelamentos e Churn</a></li>
                <li><a href="#emails">Confirma√ß√µes por Email</a></li>
                <li><a href="#implementacao">Implementa√ß√£o Pr√°tica</a></li>
                <li><a href="#melhores-praticas">Melhores Pr√°ticas</a></li>
                <li><a href="#recursos">Recursos Adicionais</a></li>
            </ul>
        </nav>

        <section id="introducao" class="section">
            <h2>Introdu√ß√£o</h2>
            <p>O Stripe √© uma das plataformas de pagamento mais robustas e confi√°veis para neg√≥cios SaaS (Software as a Service). Este guia abrangente fornece todas as informa√ß√µes necess√°rias para integrar completamente o Stripe ao seu aplicativo SaaS, desde a configura√ß√£o inicial at√© funcionalidades avan√ßadas como gerenciamento de assinaturas, webhooks e automa√ß√£o de emails.</p>
            
            <div class="highlight">
                <strong>Por que escolher o Stripe para SaaS?</strong>
                <ul>
                    <li>APIs robustas e bem documentadas</li>
                    <li>Suporte nativo para assinaturas e faturamento recorrente</li>
                    <li>Webhooks em tempo real para automa√ß√£o</li>
                    <li>Portal do cliente pr√©-constru√≠do</li>
                    <li>Suporte global para m√∫ltiplas moedas e m√©todos de pagamento</li>
                    <li>Ferramentas avan√ßadas de recupera√ß√£o de receita</li>
                </ul>
            </div>
        </section>

        <section id="visao-geral" class="section">
            <h2>Vis√£o Geral da Integra√ß√£o SAAS</h2>
            <p>A integra√ß√£o do Stripe para um neg√≥cio SaaS envolve v√°rios componentes que trabalham juntos para criar uma experi√™ncia de pagamento completa e automatizada.</p>

            <h3>Componentes Principais</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Componente</th>
                            <th>Descri√ß√£o</th>
                            <th>Tipo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Modelagem de Produto</td>
                            <td>Crie produtos para representar seus planos de servi√ßo e configure modelos de precifica√ß√£o</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                        <tr>
                            <td>Direitos (Entitlements)</td>
                            <td>Determine quando conceder ou revogar acesso a recursos do produto</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                        <tr>
                            <td>Tabela de Pre√ßos</td>
                            <td>Componente UI incorpor√°vel que exibe op√ß√µes de pre√ßos e leva ao Checkout</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                        <tr>
                            <td>Testes Gratuitos</td>
                            <td>Ofere√ßa per√≠odos de teste gratuito aos clientes</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                        <tr>
                            <td>Portal do Cliente</td>
                            <td>Interface de autoatendimento para gerenciamento de assinaturas</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                        <tr>
                            <td>Webhooks</td>
                            <td>Notifica√ß√µes em tempo real para eventos de pagamento e assinatura</td>
                            <td>C√≥digo necess√°rio</td>
                        </tr>
                        <tr>
                            <td>Recupera√ß√£o de Receita</td>
                            <td>Ferramentas autom√°ticas para reduzir churn involunt√°rio</td>
                            <td>Sem c√≥digo</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Fluxo de Integra√ß√£o T√≠pico</h3>
            <ol>
                <li><strong>Configura√ß√£o Inicial:</strong> Criar conta Stripe, obter chaves de API, configurar webhooks</li>
                <li><strong>Modelagem de Produtos:</strong> Definir produtos e planos de pre√ßos</li>
                <li><strong>Implementa√ß√£o de Checkout:</strong> Integrar Stripe Checkout ou Elements</li>
                <li><strong>Gerenciamento de Clientes:</strong> Criar e gerenciar objetos Customer</li>
                <li><strong>Assinaturas:</strong> Implementar cria√ß√£o, atualiza√ß√£o e cancelamento de assinaturas</li>
                <li><strong>Webhooks:</strong> Configurar endpoints para receber notifica√ß√µes de eventos</li>
                <li><strong>Portal do Cliente:</strong> Configurar autoatendimento para clientes</li>
                <li><strong>Testes e Deploy:</strong> Testar em modo sandbox e fazer deploy para produ√ß√£o</li>
            </ol>
        </section>


        <section id="apis-sdks" class="section">
            <h2>APIs e SDKs do Stripe</h2>
            <p>A API do Stripe √© organizada em torno de REST, utilizando URLs previs√≠veis, corpos de solicita√ß√£o codificados por formul√°rio, respostas codificadas em JSON e c√≥digos de resposta HTTP padr√£o.</p>

            <h3>Caracter√≠sticas da API</h3>
            <ul>
                <li><strong>Base URL:</strong> https://api.stripe.com</li>
                <li><strong>Protocolo:</strong> HTTPS obrigat√≥rio</li>
                <li><strong>Formato:</strong> JSON para respostas, form-encoded para requests</li>
                <li><strong>Versionamento:</strong> Controle de vers√£o por conta</li>
                <li><strong>Modo de Teste:</strong> Ambiente sandbox completo</li>
            </ul>

            <h3>Bibliotecas Cliente Oficiais</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Linguagem</th>
                            <th>Biblioteca</th>
                            <th>Instala√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Python</td>
                            <td>stripe-python</td>
                            <td><code>pip install stripe</code></td>
                        </tr>
                        <tr>
                            <td>Node.js</td>
                            <td>stripe-node</td>
                            <td><code>npm install stripe</code></td>
                        </tr>
                        <tr>
                            <td>Ruby</td>
                            <td>stripe-ruby</td>
                            <td><code>gem install stripe</code></td>
                        </tr>
                        <tr>
                            <td>PHP</td>
                            <td>stripe-php</td>
                            <td><code>composer require stripe/stripe-php</code></td>
                        </tr>
                        <tr>
                            <td>Java</td>
                            <td>stripe-java</td>
                            <td>Maven/Gradle dependency</td>
                        </tr>
                        <tr>
                            <td>Go</td>
                            <td>stripe-go</td>
                            <td><code>go get github.com/stripe/stripe-go</code></td>
                        </tr>
                        <tr>
                            <td>.NET</td>
                            <td>Stripe.net</td>
                            <td><code>Install-Package Stripe.net</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Recursos Principais da API para SAAS</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Recurso</th>
                            <th>Descri√ß√£o</th>
                            <th>Endpoint</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Customers</td>
                            <td>Representa clientes que podem ter assinaturas e m√©todos de pagamento</td>
                            <td>/v1/customers</td>
                        </tr>
                        <tr>
                            <td>Products</td>
                            <td>Define os produtos ou servi√ßos oferecidos</td>
                            <td>/v1/products</td>
                        </tr>
                        <tr>
                            <td>Prices</td>
                            <td>Define modelos de precifica√ß√£o para produtos</td>
                            <td>/v1/prices</td>
                        </tr>
                        <tr>
                            <td>Subscriptions</td>
                            <td>Gerencia assinaturas recorrentes</td>
                            <td>/v1/subscriptions</td>
                        </tr>
                        <tr>
                            <td>Invoices</td>
                            <td>Faturas geradas automaticamente ou manualmente</td>
                            <td>/v1/invoices</td>
                        </tr>
                        <tr>
                            <td>PaymentIntents</td>
                            <td>Representa inten√ß√µes de pagamento</td>
                            <td>/v1/payment_intents</td>
                        </tr>
                        <tr>
                            <td>SetupIntents</td>
                            <td>Configura m√©todos de pagamento para uso futuro</td>
                            <td>/v1/setup_intents</td>
                        </tr>
                        <tr>
                            <td>Events</td>
                            <td>Eventos para webhooks</td>
                            <td>/v1/events</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="code-block">
                <strong>Exemplo de Inicializa√ß√£o (Python):</strong><br><br>
                import stripe<br>
                stripe.api_key = "sk_test_..."<br><br>
                # Criar um cliente<br>
                customer = stripe.Customer.create(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;email="cliente@exemplo.com",<br>
                &nbsp;&nbsp;&nbsp;&nbsp;name="Jo√£o Silva"<br>
                )<br><br>
                # Criar uma assinatura<br>
                subscription = stripe.Subscription.create(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer=customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;items=[{"price": "price_1234567890"}]<br>
                )
            </div>
        </section>

        <section id="autenticacao" class="section">
            <h2>Autentica√ß√£o</h2>
            <p>A API do Stripe usa chaves de API para autenticar solicita√ß√µes. Existem dois tipos principais de chaves:</p>

            <h3>Tipos de Chaves</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Prefixo</th>
                            <th>Uso</th>
                            <th>Seguran√ßa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Chave Secreta de Teste</td>
                            <td>sk_test_</td>
                            <td>Desenvolvimento e testes</td>
                            <td>Servidor apenas</td>
                        </tr>
                        <tr>
                            <td>Chave Secreta Live</td>
                            <td>sk_live_</td>
                            <td>Produ√ß√£o</td>
                            <td>Servidor apenas</td>
                        </tr>
                        <tr>
                            <td>Chave Public√°vel de Teste</td>
                            <td>pk_test_</td>
                            <td>Frontend em desenvolvimento</td>
                            <td>Cliente seguro</td>
                        </tr>
                        <tr>
                            <td>Chave Public√°vel Live</td>
                            <td>pk_live_</td>
                            <td>Frontend em produ√ß√£o</td>
                            <td>Cliente seguro</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Seguran√ßa das Chaves:</strong>
                <ul>
                    <li>Nunca exponha chaves secretas no c√≥digo cliente</li>
                    <li>Use vari√°veis de ambiente para armazenar chaves</li>
                    <li>Considere usar chaves de API restritas para permiss√µes granulares</li>
                    <li>Rotacione chaves regularmente</li>
                </ul>
            </div>

            <h3>Configura√ß√£o de Autentica√ß√£o</h3>
            <div class="code-block">
                <strong>Vari√°veis de Ambiente (.env):</strong><br><br>
                STRIPE_SECRET_KEY=sk_test_...<br>
                STRIPE_PUBLISHABLE_KEY=pk_test_...<br>
                STRIPE_WEBHOOK_SECRET=whsec_...
            </div>

            <div class="code-block">
                <strong>Exemplo de Autentica√ß√£o (Node.js):</strong><br><br>
                const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);<br><br>
                // Fazer uma solicita√ß√£o autenticada<br>
                const customer = await stripe.customers.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;email: 'cliente@exemplo.com',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;name: 'Jo√£o Silva'<br>
                });
            </div>
        </section>

        <section id="produtos-precos" class="section">
            <h2>Produtos e Pre√ßos</h2>
            <p>No Stripe, voc√™ modela seu neg√≥cio SaaS criando Produtos que representam seus servi√ßos e Pre√ßos que definem como cobrar por eles.</p>

            <h3>Modelagem de Produtos</h3>
            <p>Um Produto no Stripe representa um bem ou servi√ßo que voc√™ oferece. Para SaaS, isso geralmente corresponde aos seus planos de assinatura.</p>

            <div class="code-block">
                <strong>Criar um Produto:</strong><br><br>
                const product = await stripe.products.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;name: 'Plano Pro',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;description: 'Acesso completo a todas as funcionalidades',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;metadata: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;features: 'unlimited_users,advanced_analytics,priority_support'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>

            <h3>Modelos de Precifica√ß√£o</h3>
            <p>O Stripe suporta diversos modelos de precifica√ß√£o para atender diferentes necessidades de neg√≥cio:</p>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Modelo</th>
                            <th>Descri√ß√£o</th>
                            <th>Exemplo de Uso</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Taxa Fixa</td>
                            <td>Pre√ßo fixo por per√≠odo</td>
                            <td>$29/m√™s para acesso completo</td>
                        </tr>
                        <tr>
                            <td>Por Assento</td>
                            <td>Pre√ßo por usu√°rio/licen√ßa</td>
                            <td>$10/usu√°rio/m√™s</td>
                        </tr>
                        <tr>
                            <td>Baseado em Uso</td>
                            <td>Cobran√ßa por consumo</td>
                            <td>$0.10 por API call</td>
                        </tr>
                        <tr>
                            <td>Em Camadas</td>
                            <td>Pre√ßos diferentes por faixas de uso</td>
                            <td>Primeiros 1000 emails gr√°tis, depois $0.01 cada</td>
                        </tr>
                        <tr>
                            <td>Graduado</td>
                            <td>Pre√ßo diminui com maior volume</td>
                            <td>$1 por usu√°rio at√© 10, $0.80 de 11-50</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Exemplos de Cria√ß√£o de Pre√ßos</h3>
            
            <h4>Pre√ßo Fixo Mensal</h4>
            <div class="code-block">
                const price = await stripe.prices.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;product: product.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;unit_amount: 2900, // $29.00 em centavos<br>
                &nbsp;&nbsp;&nbsp;&nbsp;currency: 'usd',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;recurring: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interval: 'month'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>

            <h4>Pre√ßo Por Assento</h4>
            <div class="code-block">
                const perSeatPrice = await stripe.prices.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;product: product.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;unit_amount: 1000, // $10.00 por assento<br>
                &nbsp;&nbsp;&nbsp;&nbsp;currency: 'usd',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;recurring: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interval: 'month',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage_type: 'licensed'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>

            <h4>Pre√ßo Baseado em Uso</h4>
            <div class="code-block">
                const usagePrice = await stripe.prices.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;product: product.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;unit_amount: 10, // $0.10 por unidade<br>
                &nbsp;&nbsp;&nbsp;&nbsp;currency: 'usd',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;recurring: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interval: 'month',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage_type: 'metered'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;billing_scheme: 'per_unit'<br>
                });
            </div>
        </section>


        <section id="assinaturas" class="section">
            <h2>Gerenciamento de Assinaturas</h2>
            <p>As assinaturas s√£o o cora√ß√£o de um neg√≥cio SaaS. O Stripe oferece APIs robustas para criar, gerenciar e modificar assinaturas ao longo de todo o ciclo de vida do cliente.</p>

            <h3>Ciclo de Vida de uma Assinatura</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Descri√ß√£o</th>
                            <th>A√ß√µes Dispon√≠veis</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>incomplete</td>
                            <td>Assinatura criada mas pagamento inicial pendente</td>
                            <td>Confirmar pagamento, cancelar</td>
                        </tr>
                        <tr>
                            <td>incomplete_expired</td>
                            <td>Pagamento inicial falhou e expirou</td>
                            <td>Recriar assinatura</td>
                        </tr>
                        <tr>
                            <td>trialing</td>
                            <td>Em per√≠odo de teste gratuito</td>
                            <td>Atualizar, cancelar, encerrar teste</td>
                        </tr>
                        <tr>
                            <td>active</td>
                            <td>Assinatura ativa e sendo cobrada</td>
                            <td>Atualizar, pausar, cancelar</td>
                        </tr>
                        <tr>
                            <td>past_due</td>
                            <td>Pagamento falhou, mas ainda tentando cobrar</td>
                            <td>Atualizar m√©todo de pagamento, cancelar</td>
                        </tr>
                        <tr>
                            <td>canceled</td>
                            <td>Assinatura cancelada</td>
                            <td>Reativar (se permitido)</td>
                        </tr>
                        <tr>
                            <td>unpaid</td>
                            <td>Pagamento falhou definitivamente</td>
                            <td>Atualizar m√©todo de pagamento</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Criando Assinaturas</h3>
            
            <h4>Assinatura Simples</h4>
            <div class="code-block">
                <strong>Criar uma assinatura b√°sica:</strong><br><br>
                const subscription = await stripe.subscriptions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;items: [{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price: 'price_1234567890'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;payment_behavior: 'default_incomplete',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;payment_settings: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;save_default_payment_method: 'on_subscription'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;expand: ['latest_invoice.payment_intent']<br>
                });
            </div>

            <h4>Assinatura com Per√≠odo de Teste</h4>
            <div class="code-block">
                const trialSubscription = await stripe.subscriptions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;items: [{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price: 'price_1234567890'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;trial_period_days: 14, // 14 dias de teste<br>
                &nbsp;&nbsp;&nbsp;&nbsp;metadata: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trial_type: 'free_trial'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>

            <h4>Assinatura Multi-Produto</h4>
            <div class="code-block">
                const multiProductSubscription = await stripe.subscriptions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;items: [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ price: 'price_base_plan' },<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ price: 'price_addon_storage', quantity: 5 },<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ price: 'price_addon_users', quantity: 10 }<br>
                &nbsp;&nbsp;&nbsp;&nbsp;]<br>
                });
            </div>

            <h3>Atualizando Assinaturas</h3>
            
            <h4>Mudan√ßa de Plano</h4>
            <div class="code-block">
                <strong>Upgrade/Downgrade de plano:</strong><br><br>
                const updatedSubscription = await stripe.subscriptions.update(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;items: [{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: subscription.items.data[0].id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price: 'price_new_plan'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proration_behavior: 'create_prorations' // Calcula prorata<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );
            </div>

            <h4>Altera√ß√£o de Quantidade</h4>
            <div class="code-block">
                const quantityUpdate = await stripe.subscriptions.update(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;items: [{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id: subscription.items.data[0].id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantity: 15 // Aumentar de 10 para 15 usu√°rios<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}]<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );
            </div>

            <h3>Pausar e Retomar Assinaturas</h3>
            <div class="code-block">
                <strong>Pausar assinatura:</strong><br><br>
                const pausedSubscription = await stripe.subscriptions.update(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pause_collection: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;behavior: 'void' // ou 'keep_as_draft'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );<br><br>
                <strong>Retomar assinatura:</strong><br><br>
                const resumedSubscription = await stripe.subscriptions.update(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pause_collection: null<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );
            </div>

            <h3>Cancelamento de Assinaturas</h3>
            
            <h4>Cancelamento Imediato</h4>
            <div class="code-block">
                const canceledSubscription = await stripe.subscriptions.cancel(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prorate: true, // Calcular reembolso proporcional<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_now: true // Gerar fatura imediatamente<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );
            </div>

            <h4>Cancelamento no Final do Per√≠odo</h4>
            <div class="code-block">
                const scheduledCancellation = await stripe.subscriptions.update(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;subscription.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_at_period_end: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancellation_reason: 'customer_request',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancelled_at: new Date().toISOString()<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                );
            </div>

            <div class="info">
                <strong>üí° Dica:</strong> O cancelamento no final do per√≠odo √© geralmente prefer√≠vel pois permite que o cliente continue usando o servi√ßo at√© o final do per√≠odo pago, evitando reembolsos e melhorando a experi√™ncia do cliente.
            </div>
        </section>

        <section id="webhooks" class="section">
            <h2>Webhooks e Notifica√ß√µes</h2>
            <p>Webhooks s√£o essenciais para uma integra√ß√£o robusta do Stripe. Eles permitem que seu aplicativo responda automaticamente a eventos que ocorrem na sua conta Stripe.</p>

            <h3>Como Funcionam os Webhooks</h3>
            <ol>
                <li><strong>Evento Ocorre:</strong> Algo acontece na sua conta Stripe (ex: pagamento bem-sucedido)</li>
                <li><strong>Stripe Envia Webhook:</strong> O Stripe faz uma requisi√ß√£o POST para seu endpoint</li>
                <li><strong>Seu App Processa:</strong> Seu aplicativo recebe e processa o evento</li>
                <li><strong>Resposta:</strong> Seu app retorna um status 2xx para confirmar recebimento</li>
            </ol>

            <h3>Eventos Essenciais para SAAS</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Evento</th>
                            <th>Quando Ocorre</th>
                            <th>A√ß√£o Recomendada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>customer.subscription.created</td>
                            <td>Nova assinatura criada</td>
                            <td>Provisionar acesso, enviar email de boas-vindas</td>
                        </tr>
                        <tr>
                            <td>customer.subscription.updated</td>
                            <td>Assinatura modificada</td>
                            <td>Atualizar permiss√µes, notificar mudan√ßas</td>
                        </tr>
                        <tr>
                            <td>customer.subscription.deleted</td>
                            <td>Assinatura cancelada</td>
                            <td>Revogar acesso, enviar email de despedida</td>
                        </tr>
                        <tr>
                            <td>invoice.payment_succeeded</td>
                            <td>Pagamento de fatura bem-sucedido</td>
                            <td>Confirmar renova√ß√£o, enviar recibo</td>
                        </tr>
                        <tr>
                            <td>invoice.payment_failed</td>
                            <td>Falha no pagamento</td>
                            <td>Notificar cliente, iniciar recupera√ß√£o</td>
                        </tr>
                        <tr>
                            <td>checkout.session.completed</td>
                            <td>Checkout conclu√≠do com sucesso</td>
                            <td>Confirmar compra, provisionar acesso</td>
                        </tr>
                        <tr>
                            <td>customer.created</td>
                            <td>Novo cliente criado</td>
                            <td>Criar conta no sistema, enviar boas-vindas</td>
                        </tr>
                        <tr>
                            <td>customer.updated</td>
                            <td>Dados do cliente atualizados</td>
                            <td>Sincronizar informa√ß√µes</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Implementa√ß√£o de Webhook Endpoint</h3>
            
            <h4>Estrutura B√°sica (Node.js/Express)</h4>
            <div class="code-block">
                const express = require('express');<br>
                const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);<br>
                const app = express();<br><br>
                // Middleware para webhook (raw body necess√°rio)<br>
                app.use('/webhook', express.raw({type: 'application/json'}));<br><br>
                app.post('/webhook', (req, res) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const sig = req.headers['stripe-signature'];<br>
                &nbsp;&nbsp;&nbsp;&nbsp;let event;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Verificar assinatura do webhook<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event = stripe.webhooks.constructEvent(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.body, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sig, <br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;process.env.STRIPE_WEBHOOK_SECRET<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} catch (err) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Webhook signature verification failed.', err.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).send('Webhook Error: ${err.message}');<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Processar evento<br>
                &nbsp;&nbsp;&nbsp;&nbsp;handleEvent(event);<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Retornar 200 para confirmar recebimento<br>
                &nbsp;&nbsp;&nbsp;&nbsp;res.json({received: true});<br>
                });
            </div>

            <h4>Processamento de Eventos</h4>
            <div class="code-block">
                async function handleEvent(event) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;switch (event.type) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'customer.subscription.created':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handleSubscriptionCreated(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'customer.subscription.updated':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handleSubscriptionUpdated(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'customer.subscription.deleted':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handleSubscriptionCanceled(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'invoice.payment_succeeded':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handlePaymentSucceeded(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'invoice.payment_failed':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handlePaymentFailed(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Unhandled event type:', event.type);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                }
            </div>

            <h4>Handlers Espec√≠ficos</h4>
            <div class="code-block">
                async function handleSubscriptionCreated(subscription) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const customer = await stripe.customers.retrieve(subscription.customer);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Provisionar acesso no seu sistema<br>
                &nbsp;&nbsp;&nbsp;&nbsp;await provisionUserAccess(customer.email, subscription);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Enviar email de boas-vindas<br>
                &nbsp;&nbsp;&nbsp;&nbsp;await sendWelcomeEmail(customer.email, subscription);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log('New subscription created for:', customer.email);<br>
                }<br><br>
                async function handleSubscriptionCanceled(subscription) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const customer = await stripe.customers.retrieve(subscription.customer);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Revogar acesso<br>
                &nbsp;&nbsp;&nbsp;&nbsp;await revokeUserAccess(customer.email);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Enviar email de despedida<br>
                &nbsp;&nbsp;&nbsp;&nbsp;await sendCancellationEmail(customer.email);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log('Subscription canceled for:', customer.email);<br>
                }
            </div>

            <h3>Melhores Pr√°ticas para Webhooks</h3>
            <div class="success">
                <strong>‚úÖ Melhores Pr√°ticas:</strong>
                <ul>
                    <li><strong>Verifica√ß√£o de Assinatura:</strong> Sempre verifique a assinatura do webhook</li>
                    <li><strong>Idempot√™ncia:</strong> Trate eventos duplicados adequadamente</li>
                    <li><strong>Resposta R√°pida:</strong> Retorne 2xx rapidamente, processe em background</li>
                    <li><strong>Retry Logic:</strong> Implemente l√≥gica de retry para falhas tempor√°rias</li>
                    <li><strong>Logging:</strong> Registre todos os eventos para debugging</li>
                    <li><strong>Timeout:</strong> Configure timeouts apropriados (Stripe timeout: 30s)</li>
                </ul>
            </div>
        </section>


        <section id="customer-portal" class="section">
            <h2>Portal do Cliente</h2>
            <p>O Customer Portal do Stripe √© uma solu√ß√£o pr√©-constru√≠da que permite aos clientes gerenciar suas pr√≥prias assinaturas, m√©todos de pagamento e informa√ß√µes de faturamento.</p>

            <h3>Funcionalidades do Portal</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Funcionalidade</th>
                            <th>Descri√ß√£o</th>
                            <th>Benef√≠cio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Gerenciar M√©todos de Pagamento</td>
                            <td>Adicionar, atualizar ou remover cart√µes e outros m√©todos</td>
                            <td>Reduz tickets de suporte</td>
                        </tr>
                        <tr>
                            <td>Visualizar Faturas</td>
                            <td>Acessar hist√≥rico completo de faturas e recibos</td>
                            <td>Transpar√™ncia financeira</td>
                        </tr>
                        <tr>
                            <td>Atualizar Assinaturas</td>
                            <td>Fazer upgrade/downgrade de planos</td>
                            <td>Facilita mudan√ßas de plano</td>
                        </tr>
                        <tr>
                            <td>Cancelar Assinaturas</td>
                            <td>Cancelamento self-service</td>
                            <td>Reduz churn involunt√°rio</td>
                        </tr>
                        <tr>
                            <td>Atualizar Informa√ß√µes</td>
                            <td>Modificar dados de faturamento e contato</td>
                            <td>Mant√©m dados atualizados</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Configura√ß√£o do Portal</h3>
            
            <h4>Configura√ß√£o Sem C√≥digo (Dashboard)</h4>
            <ol>
                <li>Acesse o Dashboard do Stripe</li>
                <li>V√° para "Billing" ‚Üí "Customer portal"</li>
                <li>Configure as funcionalidades desejadas</li>
                <li>Personalize a apar√™ncia (logo, cores, etc.)</li>
                <li>Ative o portal</li>
            </ol>

            <h4>Integra√ß√£o via API</h4>
            <div class="code-block">
                <strong>Criar sess√£o do portal:</strong><br><br>
                const session = await stripe.billingPortal.sessions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;return_url: 'https://seuapp.com/dashboard'<br>
                });<br><br>
                // Redirecionar cliente para session.url<br>
                res.redirect(session.url);
            </div>

            <h4>Portal com Configura√ß√£o Personalizada</h4>
            <div class="code-block">
                // Primeiro, criar uma configura√ß√£o personalizada<br>
                const configuration = await stripe.billingPortal.configurations.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;business_profile: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headline: 'Gerencie sua assinatura'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;features: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_update: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_allowed_updates: ['price', 'quantity'],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;products: [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{product: 'prod_basic', prices: ['price_basic_monthly', 'price_basic_yearly']},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{product: 'prod_pro', prices: ['price_pro_monthly', 'price_pro_yearly']}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_cancel: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode: 'at_period_end',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancellation_reason: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options: ['too_expensive', 'missing_features', 'switched_service', 'unused', 'other']<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });<br><br>
                // Usar a configura√ß√£o personalizada<br>
                const session = await stripe.billingPortal.sessions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;configuration: configuration.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;return_url: 'https://seuapp.com/dashboard'<br>
                });
            </div>

            <h3>Deflex√£o de Cancelamento</h3>
            <p>Configure ofertas especiais para clientes que tentam cancelar suas assinaturas:</p>
            
            <div class="code-block">
                const configWithRetention = await stripe.billingPortal.configurations.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;features: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription_cancel: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode: 'at_period_end',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proration_behavior: 'none',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancellation_reason: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>
        </section>

        <section id="cancelamentos" class="section">
            <h2>Cancelamentos e Redu√ß√£o de Churn</h2>
            <p>Gerenciar cancelamentos efetivamente √© crucial para a sa√∫de financeira de um neg√≥cio SaaS. O Stripe oferece v√°rias ferramentas para reduzir o churn involunt√°rio e gerenciar cancelamentos volunt√°rios.</p>

            <h3>Tipos de Churn</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Causa</th>
                            <th>Solu√ß√£o Stripe</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Churn Involunt√°rio</td>
                            <td>Falhas de pagamento (cart√£o expirado, fundos insuficientes)</td>
                            <td>Smart Retries, emails autom√°ticos, dunning management</td>
                        </tr>
                        <tr>
                            <td>Churn Volunt√°rio</td>
                            <td>Cliente decide cancelar conscientemente</td>
                            <td>Deflex√£o de cancelamento, ofertas de reten√ß√£o</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Ferramentas de Recupera√ß√£o de Receita</h3>
            
            <h4>Smart Retries</h4>
            <p>O Stripe automaticamente tenta cobrar pagamentos falhos em intervalos otimizados baseados em machine learning.</p>
            
            <div class="info">
                <strong>Como funciona:</strong>
                <ul>
                    <li>Primeira tentativa: Imediatamente ap√≥s a falha</li>
                    <li>Tentativas subsequentes: Em intervalos otimizados (3, 5, 7, 10 dias)</li>
                    <li>M√°ximo: 4 tentativas ao longo de 3 semanas</li>
                    <li>Otimiza√ß√£o: Baseada em dados hist√≥ricos de sucesso</li>
                </ul>
            </div>

            <h4>Emails Autom√°ticos</h4>
            <div class="code-block">
                <strong>Configurar emails de dunning:</strong><br><br>
                // No Dashboard: Billing ‚Üí Settings ‚Üí Customer emails<br>
                // Ou via API:<br>
                const invoice = await stripe.invoices.update('in_xxx', {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;auto_advance: true, // Tentar cobrar automaticamente<br>
                &nbsp;&nbsp;&nbsp;&nbsp;collection_method: 'charge_automatically'<br>
                });
            </div>

            <h4>Atualiza√ß√£o de M√©todo de Pagamento</h4>
            <div class="code-block">
                <strong>Solicitar atualiza√ß√£o de cart√£o:</strong><br><br>
                const setupIntent = await stripe.setupIntents.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;payment_method_types: ['card'],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;usage: 'off_session',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;metadata: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason: 'payment_failed_update_required'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                });
            </div>

            <h3>Processo de Cancelamento</h3>
            
            <h4>Cancelamento Imediato vs. Final do Per√≠odo</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Quando Usar</th>
                            <th>Impacto</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Imediato</td>
                            <td>Viola√ß√£o de termos, solicita√ß√£o espec√≠fica</td>
                            <td>Acesso revogado imediatamente, poss√≠vel reembolso</td>
                        </tr>
                        <tr>
                            <td>Final do per√≠odo</td>
                            <td>Cancelamento padr√£o do cliente</td>
                            <td>Cliente mant√©m acesso at√© o fim do per√≠odo pago</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>Implementa√ß√£o de Cancelamento Gracioso</h4>
            <div class="code-block">
                async function handleCancellationRequest(customerId, reason) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const customer = await stripe.customers.retrieve(customerId);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const subscriptions = await stripe.subscriptions.list({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer: customerId,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status: 'active'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;for (const subscription of subscriptions.data) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Cancelar no final do per√≠odo<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await stripe.subscriptions.update(subscription.id, {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_at_period_end: true,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metadata: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancellation_reason: reason,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancelled_at: new Date().toISOString()<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Enviar email de confirma√ß√£o<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await sendCancellationConfirmationEmail(customer.email, subscription);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                }
            </div>

            <h3>An√°lise de Cancelamentos</h3>
            <div class="code-block">
                <strong>Coletar motivos de cancelamento:</strong><br><br>
                // Via webhook customer.subscription.deleted<br>
                function analyzeCancellationReason(subscription) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const reason = subscription.metadata.cancellation_reason;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Salvar no analytics<br>
                &nbsp;&nbsp;&nbsp;&nbsp;analytics.track('subscription_cancelled', {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer_id: subscription.customer,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason: reason,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan: subscription.items.data[0].price.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tenure_days: calculateTenure(subscription)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                }
            </div>
        </section>

        <section id="emails" class="section">
            <h2>Confirma√ß√µes por Email</h2>
            <p>O Stripe oferece v√°rias op√ß√µes para envio autom√°tico de emails, al√©m de permitir integra√ß√£o com servi√ßos de email externos via webhooks.</p>

            <h3>Emails Autom√°ticos do Stripe</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo de Email</th>
                            <th>Quando Enviado</th>
                            <th>Configura√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Recibos de Pagamento</td>
                            <td>Ap√≥s pagamento bem-sucedido</td>
                            <td>Dashboard ‚Üí Settings ‚Üí Customer emails</td>
                        </tr>
                        <tr>
                            <td>Faturas</td>
                            <td>Quando fatura √© criada/vence</td>
                            <td>Configura√ß√£o por fatura ou global</td>
                        </tr>
                        <tr>
                            <td>Falhas de Pagamento</td>
                            <td>Quando pagamento falha</td>
                            <td>Dunning management</td>
                        </tr>
                        <tr>
                            <td>Lembretes de Teste</td>
                            <td>Antes do teste expirar</td>
                            <td>Configura√ß√£o de assinatura</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Emails Personalizados via Webhooks</h3>
            
            <h4>Email de Boas-vindas</h4>
            <div class="code-block">
                async function sendWelcomeEmail(customerEmail, subscription) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const emailData = {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to: customerEmail,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject: 'Bem-vindo ao nosso servi√ßo!',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template: 'welcome',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plan_name: subscription.items.data[0].price.nickname,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trial_end: subscription.trial_end,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dashboard_url: 'https://seuapp.com/dashboard'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;};<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;await emailService.send(emailData);<br>
                }
            </div>

            <h4>Email de Confirma√ß√£o de Pagamento</h4>
            <div class="code-block">
                async function sendPaymentConfirmation(invoice) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const customer = await stripe.customers.retrieve(invoice.customer);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const emailData = {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to: customer.email,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject: 'Pagamento confirmado - Obrigado!',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template: 'payment_success',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount: (invoice.amount_paid / 100).toFixed(2),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency: invoice.currency.toUpperCase(),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invoice_url: invoice.hosted_invoice_url,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_payment_date: new Date(invoice.period_end * 1000)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;};<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;await emailService.send(emailData);<br>
                }
            </div>

            <h4>Email de Falha de Pagamento</h4>
            <div class="code-block">
                async function sendPaymentFailedEmail(invoice) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const customer = await stripe.customers.retrieve(invoice.customer);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Criar link para atualizar m√©todo de pagamento<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const portalSession = await stripe.billingPortal.sessions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer: customer.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_url: 'https://seuapp.com/dashboard'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;const emailData = {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to: customer.email,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject: 'Problema com seu pagamento - A√ß√£o necess√°ria',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template: 'payment_failed',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data: {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount: (invoice.amount_due / 100).toFixed(2),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency: invoice.currency.toUpperCase(),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update_payment_url: portalSession.url,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retry_date: new Date(invoice.next_payment_attempt * 1000)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;};<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;await emailService.send(emailData);<br>
                }
            </div>

            <h3>Integra√ß√£o com Servi√ßos de Email</h3>
            
            <h4>Configura√ß√£o com SendGrid</h4>
            <div class="code-block">
                const sgMail = require('@sendgrid/mail');<br>
                sgMail.setApiKey(process.env.SENDGRID_API_KEY);<br><br>
                async function sendEmail(to, subject, templateId, dynamicData) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const msg = {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to: to,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: 'noreply@seuapp.com',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateId: templateId,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dynamicTemplateData: dynamicData<br>
                &nbsp;&nbsp;&nbsp;&nbsp;};<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await sgMail.send(msg);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Email sent successfully');<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} catch (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error('Email send failed:', error);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                }
            </div>
        </section>

        <section id="implementacao" class="section">
            <h2>Implementa√ß√£o Pr√°tica</h2>
            <p>Esta se√ß√£o fornece um guia passo a passo para implementar uma integra√ß√£o completa do Stripe em seu aplicativo SaaS.</p>

            <h3>Passo 1: Configura√ß√£o Inicial</h3>
            
            <h4>1.1 Criar Conta e Obter Chaves</h4>
            <ol>
                <li>Criar conta no <a href="https://dashboard.stripe.com/register" target="_blank">Stripe Dashboard</a></li>
                <li>Ativar sua conta (verifica√ß√£o de identidade)</li>
                <li>Obter chaves de API em "Developers" ‚Üí "API keys"</li>
                <li>Configurar webhooks em "Developers" ‚Üí "Webhooks"</li>
            </ol>

            <h4>1.2 Configurar Ambiente de Desenvolvimento</h4>
            <div class="code-block">
                # Instalar Stripe CLI<br>
                curl -s https://packages.stripe.com/api/security/keypair/stripe-cli-gpg/public | gpg --dearmor | sudo tee /usr/share/keyrings/stripe.gpg<br>
                echo "deb [signed-by=/usr/share/keyrings/stripe.gpg] https://packages.stripe.com/stripe-cli-debian-local stable main" | sudo tee -a /etc/apt/sources.list.d/stripe.list<br>
                sudo apt update<br>
                sudo apt install stripe<br><br>
                # Login no Stripe CLI<br>
                stripe login<br><br>
                # Testar webhooks localmente<br>
                stripe listen --forward-to localhost:3000/webhook
            </div>

            <h3>Passo 2: Modelagem de Produtos</h3>
            
            <h4>2.1 Criar Produtos via Dashboard</h4>
            <ol>
                <li>Ir para "Products" no Dashboard</li>
                <li>Clicar em "Add product"</li>
                <li>Definir nome, descri√ß√£o e pre√ßos</li>
                <li>Configurar modelos de precifica√ß√£o</li>
            </ol>

            <h4>2.2 Criar Produtos via API</h4>
            <div class="code-block">
                // Criar produtos programaticamente<br>
                const products = [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: 'Plano B√°sico',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description: 'Funcionalidades essenciais para come√ßar',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prices: [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ amount: 990, interval: 'month' },<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ amount: 9900, interval: 'year' }<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
                &nbsp;&nbsp;&nbsp;&nbsp;},<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: 'Plano Pro',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description: 'Funcionalidades avan√ßadas para crescer',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prices: [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ amount: 2990, interval: 'month' },<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ amount: 29900, interval: 'year' }<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                ];<br><br>
                async function createProducts() {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;for (const productData of products) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const product = await stripe.products.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: productData.name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description: productData.description<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (const priceData of productData.prices) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await stripe.prices.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product: product.id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unit_amount: priceData.amount,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency: 'usd',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recurring: { interval: priceData.interval }<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                }
            </div>

            <h3>Passo 3: Implementar Checkout</h3>
            
            <h4>3.1 Stripe Checkout (Recomendado)</h4>
            <div class="code-block">
                // Backend: Criar sess√£o de checkout<br>
                app.post('/create-checkout-session', async (req, res) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const { priceId, customerId } = req.body;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;const session = await stripe.checkout.sessions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer: customerId,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;payment_method_types: ['card'],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_items: [{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price: priceId,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantity: 1<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}],<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode: 'subscription',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success_url: 'https://seuapp.com/success?session_id={CHECKOUT_SESSION_ID}',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancel_url: 'https://seuapp.com/pricing'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;res.json({ url: session.url });<br>
                });<br><br>
                // Frontend: Redirecionar para checkout<br>
                async function subscribeToPlan(priceId) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const response = await fetch('/create-checkout-session', {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: 'POST',<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: { 'Content-Type': 'application/json' },<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: JSON.stringify({ priceId, customerId })<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;const { url } = await response.json();<br>
                &nbsp;&nbsp;&nbsp;&nbsp;window.location.href = url;<br>
                }
            </div>

            <h3>Passo 4: Configurar Webhooks</h3>
            
            <h4>4.1 Endpoint de Webhook Completo</h4>
            <div class="code-block">
                const express = require('express');<br>
                const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);<br>
                const app = express();<br><br>
                app.use('/webhook', express.raw({type: 'application/json'}));<br><br>
                app.post('/webhook', async (req, res) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const sig = req.headers['stripe-signature'];<br>
                &nbsp;&nbsp;&nbsp;&nbsp;let event;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event = stripe.webhooks.constructEvent(<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.body, sig, process.env.STRIPE_WEBHOOK_SECRET<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} catch (err) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Webhook signature verification failed.', err.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).send('Webhook Error: ${err.message}');<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;// Processar evento de forma ass√≠ncrona<br>
                &nbsp;&nbsp;&nbsp;&nbsp;processWebhookEvent(event);<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;res.json({received: true});<br>
                });<br><br>
                async function processWebhookEvent(event) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (event.type) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'checkout.session.completed':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handleCheckoutCompleted(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'customer.subscription.created':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handleSubscriptionCreated(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 'invoice.payment_succeeded':<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await handlePaymentSucceeded(event.data.object);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Adicionar outros eventos...<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} catch (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error('Error processing webhook:', error);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                }
            </div>

            <h3>Passo 5: Configurar Customer Portal</h3>
            <div class="code-block">
                // Rota para acessar o portal do cliente<br>
                app.post('/create-portal-session', async (req, res) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const { customerId } = req.body;<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;const portalSession = await stripe.billingPortal.sessions.create({<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;customer: customerId,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return_url: 'https://seuapp.com/dashboard'<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
                &nbsp;&nbsp;&nbsp;&nbsp;res.json({ url: portalSession.url });<br>
                });
            </div>
        </section>

        <section id="melhores-praticas" class="section">
            <h2>Melhores Pr√°ticas</h2>
            
            <h3>Seguran√ßa</h3>
            <div class="success">
                <strong>‚úÖ Pr√°ticas de Seguran√ßa:</strong>
                <ul>
                    <li><strong>Chaves de API:</strong> Nunca exponha chaves secretas no frontend</li>
                    <li><strong>Webhooks:</strong> Sempre verifique assinaturas de webhook</li>
                    <li><strong>HTTPS:</strong> Use HTTPS em produ√ß√£o</li>
                    <li><strong>Valida√ß√£o:</strong> Valide todos os dados de entrada</li>
                    <li><strong>Logs:</strong> Registre eventos importantes para auditoria</li>
                </ul>
            </div>

            <h3>Performance</h3>
            <div class="info">
                <strong>üí° Otimiza√ß√µes de Performance:</strong>
                <ul>
                    <li><strong>Webhooks Ass√≠ncronos:</strong> Processe webhooks em background</li>
                    <li><strong>Cache:</strong> Cache dados do Stripe quando apropriado</li>
                    <li><strong>Batch Operations:</strong> Use opera√ß√µes em lote quando poss√≠vel</li>
                    <li><strong>Timeouts:</strong> Configure timeouts apropriados</li>
                </ul>
            </div>

            <h3>Experi√™ncia do Usu√°rio</h3>
            <div class="highlight">
                <strong>üéØ UX Best Practices:</strong>
                <ul>
                    <li><strong>Transpar√™ncia:</strong> Seja claro sobre pre√ßos e pol√≠ticas</li>
                    <li><strong>Self-Service:</strong> Use o Customer Portal para reduzir suporte</li>
                    <li><strong>Comunica√ß√£o:</strong> Mantenha clientes informados sobre mudan√ßas</li>
                    <li><strong>Recupera√ß√£o:</strong> Implemente fluxos de recupera√ß√£o de pagamento</li>
                </ul>
            </div>

            <h3>Monitoramento</h3>
            <div class="warning">
                <strong>‚ö†Ô∏è M√©tricas Importantes:</strong>
                <ul>
                    <li><strong>Churn Rate:</strong> Taxa de cancelamento</li>
                    <li><strong>MRR/ARR:</strong> Receita recorrente mensal/anual</li>
                    <li><strong>Payment Success Rate:</strong> Taxa de sucesso de pagamentos</li>
                    <li><strong>Customer Lifetime Value:</strong> Valor vital√≠cio do cliente</li>
                </ul>
            </div>
        </section>

        <section id="recursos" class="section">
            <h2>Recursos Adicionais</h2>
            
            <h3>Documenta√ß√£o Oficial</h3>
            <ul>
                <li><a href="https://docs.stripe.com/" target="_blank">Stripe Documentation</a></li>
                <li><a href="https://docs.stripe.com/api" target="_blank">API Reference</a></li>
                <li><a href="https://docs.stripe.com/saas" target="_blank">SaaS Integration Guide</a></li>
                <li><a href="https://docs.stripe.com/webhooks" target="_blank">Webhooks Documentation</a></li>
            </ul>

            <h3>Ferramentas de Desenvolvimento</h3>
            <ul>
                <li><a href="https://github.com/stripe/stripe-cli" target="_blank">Stripe CLI</a></li>
                <li><a href="https://marketplace.visualstudio.com/items?itemName=Stripe.vscode-stripe" target="_blank">Stripe VS Code Extension</a></li>
                <li><a href="https://dashboard.stripe.com/workbench" target="_blank">Stripe Workbench</a></li>
            </ul>

            <h3>Bibliotecas e SDKs</h3>
            <ul>
                <li><a href="https://github.com/stripe/stripe-node" target="_blank">Node.js Library</a></li>
                <li><a href="https://github.com/stripe/stripe-python" target="_blank">Python Library</a></li>
                <li><a href="https://github.com/stripe/stripe-ruby" target="_blank">Ruby Library</a></li>
                <li><a href="https://github.com/stripe/stripe-php" target="_blank">PHP Library</a></li>
            </ul>

            <h3>Comunidade e Suporte</h3>
            <ul>
                <li><a href="https://support.stripe.com/" target="_blank">Stripe Support</a></li>
                <li><a href="https://stackoverflow.com/questions/tagged/stripe-payments" target="_blank">Stack Overflow</a></li>
                <li><a href="https://github.com/stripe" target="_blank">Stripe GitHub</a></li>
            </ul>
        </section>

        <footer style="text-align: center; padding: 40px 0; background: #f8f9fa; margin-top: 40px; border-radius: 12px;">
            <p style="color: #666; margin-bottom: 10px;">Este guia foi compilado para fornecer uma vis√£o abrangente da integra√ß√£o Stripe para SAAS.</p>
            <p style="color: #666;">Para informa√ß√µes mais atualizadas, sempre consulte a <a href="https://docs.stripe.com/" target="_blank" style="color: #635bff;">documenta√ß√£o oficial do Stripe</a>.</p>
        </footer>
    </div>

    <script>
        // Smooth scrolling para links de navega√ß√£o
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Highlight da se√ß√£o atual na navega√ß√£o
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.style.backgroundColor = '';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.backgroundColor = '#f3f4f6';
                }
            });
        });
    </script>
</body>
</html>

